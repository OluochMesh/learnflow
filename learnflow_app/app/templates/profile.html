{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Your Profile</h1>

    <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Account Information</h2>
        <div class="space-y-3">
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p>
                <strong>Plan:</strong> 
                <span class="px-2 py-1 text-sm rounded-full 
                    {% if user.subscription_status == 'pro' %}bg-purple-100 text-purple-800
                    {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                    {{ user.subscription_status|upper }}
                </span>
            </p>
            <p><strong>Member since:</strong> {{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'Recently' }}</p>
        </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-sm">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Subscription</h2>
        
        {% if user.subscription_status == 'free' %}
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <h3 class="font-semibold text-blue-800 mb-2">Upgrade to LearnFlow Pro</h3>
                <p class="text-blue-700 mb-3">Get unlimited AI analysis and advanced features for just $2/month</p>
                <ul class="text-blue-600 text-sm space-y-1 mb-4">
                    <li>âœ… Unlimited learning sessions</li>
                    <li>âœ… Priority AI processing</li>
                    <li>âœ… Detailed progress analytics</li>
                    <li>âœ… Export your learning history</li>
                </ul>
                <button onclick="upgradeToPro()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    Upgrade to Pro - $2/month
                </button>
            </div>
        {% else %}
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <h3 class="font-semibold text-green-800 mb-2">You're a Pro Member! ðŸŽ‰</h3>
                <p class="text-green-700">Thank you for supporting LearnFlow. You have access to all features.</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
async function upgradeToPro() {
    try {
        const response = await fetch('/create-checkout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const data = await response.json();
        if (data.checkout_url) {
            window.location.href = data.checkout_url;
        } else {
            alert('Error: ' + (data.error || 'Failed to create payment session'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to initiate payment');
    }
}
</script>
{% endblock %}